# 极客园H5项目(前台)

## 项目介绍

内容：

极客园 H5 端项目：个人自媒体前台

>「极客园」对标`CSDN`、`博客园`等竞品，致力成为更加贴近年轻 IT 从业者（学员）的科技资讯类应用 
>产品关键词：IT、极客、活力、科技、技术分享、前沿动态、内容社交 
>用户特点：年轻有活力，对IT领域前言科技信息充满探索欲和学习热情

项目功能和演示，包括

- 短信登录、退出
- 首页-频道管理，文章列表，更多操作
- 文章详情-文章详情，文章评论，评论回复，点赞，收藏，关注
- 个人中心-个人资料展示，个人资料编辑

技术栈：

- 项目搭建：React 官方脚手架 `create-react-app`
- react hooks
- 状态管理：redux + `@reduxjs/toolkit`
- UI 组件库：`antd-mobile` v6
- ajax请求库：`axios`
- 路由：`react-router-dom` 以及 `history`
- CSS 预编译器：`sass`
- CSS Modules 避免组件之间的样式冲突
- **TypeScript**
- 工具库：lodash
- hooks 库：ahooks
- websocket 即时通讯

## 项目搭建

### 基本结构

1. 搭建支持TypeScript的项目`npx create-react-app geek-h5 --template typescript`
2. 进入项目根目录：`cd 项目名称`
3. 启动项目：yarn start
4. 调整项目目录结构：

```js
/src
  /assets         项目资源文件，比如，图片 等
  /components     通用组件
  /pages          页面
  /store          Redux 状态仓库
  /types          TS 类型，包括：接口、redux等类型
  /utils          工具，比如，token、axios 的封装等
  App.scss        根组件样式文件
  App.tsx         根组件
  index.scss      全局样式
  index.tsx       项目入口
```

### 核心代码

`scr/index.tsx`

```js
import { createRoot } from 'react-dom/client'
import './index.scss'
import App from './App'

const root = createRoot(document.getElementById('root'))
root.render(<App />)
```

`src/index.scss`

```js
html,
body {
  margin: 0;
  padding: 0;
}

html,
body,
#root {
  height: 100%;
}

* {
  box-sizing: border-box;
}

p,
h2,
h3 {
  margin: 0;
}
```

`src/App.tsx`

```js
import './App.scss'

function App() {
  return <div className="app"></div>
}

export default App
```

`src/App.scss`

```js
// 注意： 别忘了此处的样式设置！

.app {
  height: 100%;
}
```

### 样式的使用

1. 在本项目中使用sass写样式
2. 安装sass解析包：yarn add sass

### 路由配置

1. 安装路由：`yarn add react-router-dom`

2. 如果报错，就安装路由的声明文件`yarn add @types/react-router-dom -D`

3. 在src/pages目录下创建两个文件夹：Login、Layout

   1. src/pages/Login
   2. src/pages/Layout

4. 分别在两个目录中创建index.tsx文件，并创建一个简单的组件后导出

   1. `src/pages/Login/index.tsx`

      1. ```js
         const Login = () => {
           return <div>Login页面</div>
         }
         export default Login
         ```

   2. `src/pages/Layout/index.tsx`

      1. ```js
         const Layout = () => {
           return <div>Layout页面</div>
         }
         export default Layout
         ```

5. 在App组件中，导入路由组件以及两个页面组件,配置Login和Layout的路由规则 

   1. `/src/App.tsx`

   2. ```js
      // 导入路由
      import { BrowserRouter as Router, Routes } from 'react-router-dom'
      
      // 导入页面组件
      import Login from './pages/Login'
      import Layout from './pages/Layout'
      
      // 配置路由规则
      function App() {
        return (
      		<Router>
            <div className="app">
              <Routes>
                <Route path="/home" element={Layout} />
                <Route path="/login" element={Login} />
              </Routes>
            </div>
          </Router>
        )
      }
      
      export default App
      ```

6. 默认展示首页

   1. 在App.tsx中添加一个新的Route,用来匹配默认路由

   2. 在element中，渲染`Navigate`组件实现路由重定向

      1. `src/App.tsx`

      2. ```js
         // 导入路由
         import { BrowserRouter as Router, Routes } from 'react-router-dom'
         import { Navigate } from 'react-router-dom'
         
         // 导入页面组件
         import Login from './pages/Login'
         import Layout from './pages/Layout'
         
         // 配置路由规则
         function App() {
           return (
         		<Router>
               <div className="app">
                 <Routes>
             			<Route path="/" element={<Navigate to="/home" />} />
                   <Route path="/home" element={Layout} />
                   <Route path="/login" element={Login} />
                 </Routes>
               </div>
             </Router>
           )
         }
         
         export default App
         ```

### CSS变量

1. [MDN - CSS变量（自定义属性）](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Using_CSS_custom_properties)

2. CSS自定义属性，通常称为`CSS变量`，类似于JS中声明的变量，可以复用CSS属性值

   1. ```js
      /* 
        比如，项目中多次使用某一个颜色值，原来需要重复写多次
      */
      .list-item-active {
        color: #fc6627;
      }
      
      .tabs-item-active {
        color: #fc6627;
      }
      
      /* 
        使用 CSS 变量来实现复用
      */
      
      /* 1 创建全局 CSS 变量 --geek-color-primary*/
      :root {
        --geek-color-primary: #fc6627;
      }
      /* 2 复用 */
      .list-item-active {
        color: var(--geek-color-primary);
      }
      
      .tabs-item-active {
        color: var(--geek-color-primary);
      }
      ```

3. 特点

   1. 可复用

   2. 语义化，`--geek-color-primary`比`#fc6627`更容易理解

   3. 分全局CSS变量`全局有效`和局部CSS变量`只在某个作用域内(比如，某个类名)`有效

   4. ```js
      /*
        全局 CSS 变量
        1. 使用 :root 这个 CSS 伪类匹配文档树的根元素 html。可以在CSS文件的任意位置使用该变量
           相当于 JS 变量中的全局
        2. CSS 变量通过两个减号（--）开头，多个单词之间推荐使用 - 链接。CSS 变量名可以是任意变量名
      */
      :root {
        --geek-color-primary: #fc6627;
      }
      /* 使用 */
      .tabs-item-active {
        color: var(--geek-color-primary);
      }
      .list-item-active {
        color: var(--geek-color-primary);
      }
      
      /* 
        局部 CSS 变量
      */
      .list {
        --active-color: #1677ff;
      
        /* 在该 类 内部使用改变量 */
        color: var(--active-color);
      }
      .test {
        color: var(--active-color); /* 错误演示：无效！效果与不使用该变量时一致*/
      }
      ```

### antd-mobile组件库

1. `antd-mobile`是**Ant Design**的移动规范的**React**实现，服务于蚂蚁及口碑无线业务

2. 安装`yarn add antd-mobile`

3. 导入 Button 组件，在Login页面渲染Button组件

   1. `src/pages/Login/index.tsx`

   2. ```js
      import { Button } from 'antd-mobile'
      
      const Login = () => (
        <div>
          <Button color="primary">Button</Button>
        </div>
      )
      ```

4. 用原生CSS变量定制极客园主题

   1. `src/index.scss`

   2. `:root:root`用来保证自己写的样式的优先级比组件库的高

   3. ```js
      :root:root {
        --adm-color-primary: #fc6627;
        --adm-font-family: 'PingFangSC-Regular';
        
        --font-size: 16px;
      }
      ```

   4. 
