## 小程序基础

### 今日目标

1. 什么是小程序
3. 小程序开发者工具的使用
4. 对小程序的结构（目录、文件、json、js）进行分析
6. 小程序组件的基本使用
8. 小程序如何发布和上线

### 1. 开发准备

#### 1.1 小程序的概念

> [小程序](https://mp.weixin.qq.com/cgi-bin/wx?token=&lang=zh_CN)是一种不需要下载、安装即可使用的应用，它实现了应用触手可及的梦想，用户扫一扫或者搜一下就能打开应用，也实现了用完即走的理念，用户不用安装太多应用，应用随处可用，但又无须安装卸载。

1. 特点：无需下载（并非不下载，而是小程序体积非常小，用户感知不到下载的过程 打开任意一个小程序(2MB)、无需卸载
2. 理念：用完即走（让用户在短时间内完成某件操作，用户离开小程序即可，并不需要关注小程序本身）
3. 入口：扫一扫、搜一下、群聊……
4. 方便：功能几乎和App一样全面，包括语音、支付、扫码……
5. 安全：安全无需自己维护，由宿主App直接负责。

###### 小程序和web区别

- 普通 HTML5 都是执行在浏览器的宿主环境，浏览器提供 `window`、`document` 等 BOM 对象，但小程序没有 `window`、`document`
- 小程序是运行在微信App中，它更像是一个类似 Node.js 的宿主环境；因此在小程序内不能使用 `document.querySelector` 这类 DOM 选择器，也不支持 `XMLHttpRequest`、`location`、`localStorage` 等这些浏览器提供的 API，只能使用小程序自己实现的 API

###### 小程序工作原理

小程序的渲染层和逻辑层分别由2个线程管理：

- 渲染层的界面使用了WebView 进行渲染；

- 逻辑层采用 JsCore 线程运行 JS 脚本;
-  一个小程序存在多个界面，所以渲染层存在多个 WebView 线程，这两个线程的通信会经由微信客户端做中转，逻辑层发送网络请求也经由 Native 转发，小程序的通信模型下图所示。

![image-20220710214759622](images/image-20220710214759622.png)

#### 1.2 注册账号

开发微信小程序前首先要在[微信公众平台](https://mp.weixin.qq.com/)注册一个小程序账号，通过这个账号对小程序的开发进行管理。

注册步骤如下图所示：

1. 点击注册按钮

   使用浏览器打开 [微信公众平台](https://mp.weixin.qq.com/ ) 网址，点击右上角的 "立即注册" 即可进入到小程序开发账号的注册流程

![](./images/1-4 注册账号.jpg)



2. 选择注册的帐号类型

![](./images/1-5 注册账号.jpg)





3. 填写账号信息


![](./images/1-6 注册账号.jpg)





4. 邮箱激活

![](./images/1-7 注册账号.jpg)







5. 点击链接激活账号

![](./images/1-10 注册账号.jpg)



6. 选择主体类型

![](./images/1-8 注册账号.jpg)





7. 主体登记信息

![](./images/1-9 注册账号.jpg)



8. 注册完毕

1.3 小程序信息

账号注册完毕后还需要进一步对小程序的信息进行完善：

![](./images/img-11.jpg)

注意：在填写小程序类目时**不**需要选择游戏类型

#### 1.4 获取AppID

AppID 是小程序的唯一标识，在对小程序进行开发或者上线发布时都会用到 AppID，获取方式如下图所示：

![image-20220706101811865](images/image-20220706101811865.png)



#### 1.5 微信开发者工具

微信开发者工具是官方提供的专门用于开发小程序开发，它提供的主要功能如下：

- 快速创建小程序项目（起到脚手架的作用）
- 代码的查看和编辑（相当于 vs code 作用）
- 对小程序功能进行调试（相当于浏览器作用）
- 小程序的预览和发布

[下载](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)并安装微信开发者工具，它是一个普通的安装程序，双击后根据引导下一步、下一步操作直到完成，安装完毕后打开微信开发者工具，首次打开时需要先进行登录（使用注册账号时的管理员微信扫码即可）

![](./images/1-12 扫码登录.jpg)

### 2. 小程序开发

#### 2.1 创建小程序

通过小程序开发者工具创建一个新的项目，步骤如下图所示：

1. 点击 + 号，新建项目
   
   ![image-20220705215421016](images/image-20220705215421016.png)
   
2. 填写项目信息
   
   ![image-20220707143129537](images/image-20220707143129537.png)

3. 启动小程序项目

![img-18.png](images/img-18.png)

4. 编辑器介绍

![image-20220710220007032](images/image-20220710220007032.png)

#### 2.2 目录结构

成功创建小程序项目后会初始小程序的目录结构（一些文件和目录），我们先来了解一下这些文件和目录的作用，这对于我们学习小程序开发非常有帮助。

小程序的开发语言跟前端开发者比较熟悉的 HTML5 非常相似（甚至相同），小程序的视图层由 `WXML` 和 `WXSS` 组成，分别对应 HTML 和 CSS，逻辑层则跟 HTML5 一样，也是 JavaScript 语言实现

我们将从两个方面入手来介绍小程序的目录结构：文件类型和特定名称的文件

先来看文件类型，小程序主要提供了 4 种文件类型：

| 类型名称 | 作用                                          | 是否必须存在 |
| -------- | --------------------------------------------- | ------------ |
| .wxml    | 小程序页面的布局结构，相当于网页中 .html 文件 | 是           |
| .wxss    | 小程序页面的样式，相当于网页中的 .css 文件    | 否           |
| .js      | 小程序页面的逻辑，就是之前所学的 javascript   | 是           |
| .json    | 小程序页面的配置                              | 否           |

我们了解的是小程序的每个页面都是由以前文件类型的文件共同构成的。 记住 `四个文件必须是相同的名字和路径`

再来看一些**特定名称**的文件：

| 文件名              | 作用                                      | 是否必须存在     |
| ------------------- | ----------------------------------------- | ---------------- |
| app.js              | 小程序入口（首先执行的文件）              | 是               |
| app.json            | 小程序的**全局**配置                      | 是               |
| app.wxss            | 小程序的**全局**样式                      | 否               |
| project.config.json | 小程序**开发者工具**配置，项目名称，AppID | 是（会自动创建） |
| sitemap.json        | 小程序搜索优化                            | 否               |

注意：小程序 JS 的执行环境并不是普通的 WebView 浏览器，也不是 Node.js 环境，它执行在微信 App 内上下文， 跟 Node.js 一样，也不能像在浏览器内一样对页面 DOM 进行操作。

以上关于文件类型及特定文件相关的细节，后续学习过程中会逐步讲解，在此只是先对目结构有个大致的了解！

#### 2.3 牛刀小试

在对小程序目录结构有了简单了解后再结合之前所学的网页的相关知识简单修改部分代码来看看效果，修改的需求为：将小程序页面中的文字颜色变成红色，字号变成 20px。

通过上面的讲解我们知道 .wxml 是用来定义页面内容及结构的，所以我们先从 .wxml 入手，打开 `pages/index/index.wxml` 找到如下代码：

```xml
<!-- 第 20 ~ 22 行 -->
<view class="usermotto">
  <text class="user-motto">{{motto}}</text>
</view>
```

在此基础上改变一些内容（加了几个感叹号），保存代码后，页面中立刻发生了变化（刷新）

```xml
<!-- 第 20 ~ 22 行 -->
<view class="usermotto">
  <text class="user-motto">{{motto}}!!!</text>
</view>
```

通过这一步操作体会一下 .wxml 类型的文件相当于 html 用来定义页面中的内容和结构。

接下来打开 `pages/index/index.wxss`，找到 `.usermotto` 这个选择器，如下代码所示：

```css
/* 第 17 ~ 19 行 */
.usermotto {
  margin-top: 200px;
}
```

在此基础上修改一些样式，设置字号及颜色，保存代码后，页面也会立刻发生变化（刷新）

```css
.usermotto {
  font-size: 20px;
  color: red;
  margin-top: 200px;
}
```

通过这一步操作体会一下 .wxss 类型的文件相当于 css 用来定义页面样式，并且似乎（事件也是这样的）和 css 的属性也都是一样的！

至于 .js 和 .json 等其它内容我们后面会有专门的章节进行讲解。

#### 2.4 实现页面导航布局

通过一个小案例来学习小程序页面布局的相关知识，主要涉及到小程序内置的组件（标签）用样式的使用。

如下图所示是比较常见的顶部页面导航的布局，要实这个布局会用于小程序中提供的一些组件（标签）如下表所示：

| 组件名（标签）                                               | 作用             | 与 html 对比                       |
| ------------------------------------------------------------ | ---------------- | ---------------------------------- |
| view                                                         | 定义一个块级元素 | 相当于 html 中的 div 标签          |
| text                                                         | 定义一个行内元素 | 相当于 html 中的 span 标签         |
| [scroll-view](https://developers.weixin.qq.com/miniprogram/dev/component/scroll-view.html) | 可滚动视图区域   | 相当于css中的overflow-x/overflow-y |

关于小程序中的样式几乎和网页的 css 是一样的，先学习部分选择器的使用，如下表所示：

| 选择器     | 示例       |
| ---------- | ---------- |
| 类选择器   | .navs      |
| 标签选择器 | text、view |
| 后代选择器 | .navs text |

我们暂时在 `pages/index/index.wxml` 和 `pages/index/index.wxss` 中编写代码（将原来的示例代码先全选删除）

导航布局

<img src="images/image-20220708155416210.png" alt="image-20220708155416210" style="zoom:50%;" />

完整代码如下所示：

```xml
<!-- pages/index/index.wxml -->
<view class="navs">
  <text class="active">推荐</text>
  <text>食品</text>
  <text>内衣</text>
  <text>生鲜</text>
  <text>母婴</text>
</view>
```

```css
/* pages/index/index.wxss */
.navs {
  display: flex;
  justify-content: space-evenly;
  height: 44px;
  padding: 0 10px;
  line-height: 44px;
  border-top: 1px solid #eee;
  /* background-color: pink; */
}

.navs text {
  width: 50px;
  text-align: center;
  color: #333;
}

.navs .active {
  color: #f5a11c;
  font-size: 18px;
  position: relative;
  top: 2px;
}

.navs .active::after {
  content: "";
  position: absolute;
  left: 50%;
  bottom: 6px;
  height: 2px;
  width: 12px;
  transform: translate(-50%);
  border-radius: 2px;
  background-color: #f5a11c;
}
```

设置导航横向滚动:

1. 给`scroll-view`添加`scroll-x="true"`属性
2. 给`scroll-view`添加`white-space:nowrap;`样式
3. 给`scroll-view`中的子元素设置为`display:inline-block;`



通过上述的小例子大家要体会在编写小程序页面时与网页布局几乎是一致的，所不同的就是小程序中使用了一些特定的组件（组件），关于样式部分和 css 几乎完全一致。

<img src="images/image-20220708091503735.png" alt="image-20220708091503735" style="zoom:50%;" />

注意点：.wxss中本地资源无法通过 `background-image` 获取，可以使用网络图片必须是`https开头协议`，或者 `base64`，或者使用标签

```css
background-image: url(https://api-hmugo-web.itheima.net/pyg/banner1.png);
```

注意点：在小程序内，不支持使用 webfont 的 `@font-face` 引入本地的 ttf 等文件，这时候需要使用线上地址或者 `base64`。

```css
@font-face {
  font-family: 'icomoon';
  src:  url('https://static.botue.com/ugo/fonts/icomoon.eot?rnu94l');
  src:  url('https://ekafit.oss-cn-beijing.aliyuncs.com/ugo/fonts/icomoon.eot?rnu94l#iefix') format('embedded-opentype'),
    url('https://static.botue.com/ugo/fonts/icomoon.ttf?rnu94l') format('truetype'),
    url('https://static.botue.com/ugo/fonts/icomoon.woff?rnu94l') format('woff'),
    url('https://static.botue.com/ugo/fonts/icomoon.svg?rnu94l#icomoon') format('svg');
  font-weight: normal;
  font-style: normal;
  font-display: block;
}

[class^="icon-"], [class*=" icon-"] {
  /* use !important to prevent issues with browser extensions that change fonts */
  font-family: 'icomoon' !important;
  speak: none;
  font-style: normal;
  font-weight: normal;
  font-variant: normal;
  text-transform: none;
  line-height: 1;

  /* Better Font Rendering =========== */
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.icon-bill:before {
  content: "\e900";
}
.icon-car:before {
  content: "\e901";
}
.icon-list:before {
  content: "\e902";
}
.icon-cart:before {
  content: "\e903";
}
.icon-top:before {
  content: "\e904";
}
.icon-handset:before {
  content: "\e905";
}
.icon-star:before {
  content: "\e906";
}
.icon-money:before {
  content: "\e907";
}
.icon-arrow:before {
  content: "\e908";
}

```

另外大家有没有发现样式文件不需要引入到页面当中，它是自动引入并生效的，但是要求**`页面文件的名称和样式的文件必须要一致！`**

#### 2.5 小程序适配

小程序大部情况下是运行在手机端的它也需要像移动Web一样来处理不同大小屏幕的适配，小程序中适配的方法非常简单，它提供了专门的单位 `rpx （responsive pixel）`直译为：`响应像素` 它会自动的根据屏幕的大小转换成 `px`，可以自动适配所有大小的屏幕 。

详细见课堂演示。

实际应用的过程中设计稿的尺寸都是以 `750px` 做为基准，我们只需要将实现的单位写成相应的 `rpx` 即可，或者理解成图片尺寸是多大我们就写成多少 `rpx`。

#### 2.6 实现轮播图交互

为了让大家对小程序内置组件有更多的了解，我们再来看几个功能强大的组件：

| 组件名（标签）                                               | 作用                                 | 与 html 对比        |
| ------------------------------------------------------------ | ------------------------------------ | ------------------- |
| swiper                                                       | 滑块视图容器                         | 无                  |
| swiper-item                                                  | 可滑动的区块（必须用在 swiper 内部） | 无                  |
| [image](https://developers.weixin.qq.com/miniprogram/dev/component/image.html) | 图片                                 | img（注意名称区别） |

swiper 的强大之处在于它允许通过属性的方式对轮播图进行配置，常见的属性包括：

| 属性名                                                       | 默认值            | 作用                 |
| ------------------------------------------------------------ | ----------------- | -------------------- |
| indicator-dots                                               | false             | 是否显示面板指示点   |
| autoplay                                                     | false             | 是否自动切换         |
| circular                                                     | false             | 是否采用衔接滑动     |
| indicator-color                                              | rgba(0, 0, 0, .3) | 指示点颜色           |
| indicator-active-color                                       | \#000000          | 当前选中的指示点颜色 |
| ... 还有[更多](https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html) |                   |                      |

swipe 的功能强大提供的属性非常多，不过不用头疼，常用的就几个以后根据开发需求随用随查就可以了。

代码如下：

```html
 <swiper class="swiper-box" indicator-dots autoplay="2000" circular indicator-color="#fff" indicator-active-color="#f00">
  <swiper-item>
    <image src="/static/uploads/slide_1.jpg"></image>
  </swiper-item>
  <swiper-item>
    <image src="/static/uploads/slide_2.jpg"></image>
  </swiper-item>
  <swiper-item>
    <image src="/static/uploads/slide_3.jpg"></image>
  </swiper-item>
  <swiper-item>
    <image src="/static/uploads/slide_4.jpg"></image>
  </swiper-item>
  <swiper-item>
    <image src="/static/uploads/slide_5.jpg"></image>
  </swiper-item>
</swiper>
```

```css
.swiper-box {
  width: 100%;
  height: 320rpx;
}

.swiper-box image {
  width: 100%;
  height: 100%;
}
```



#### 2.7 购物车计数器

有了小程序布局相关知识后我们来进一步学习一下小程序中如何处理逻辑，如数据渲染和事件处理等，我们通过实现购物车计数器功能为例展开学习。

打开 `pages/index/index.js` 将原来的全部内容都删除掉，我们一点点添加代码。

在动手前最先要了解的是每个页面的 .js 文件中**必须调用**一个内置全局的函数 `页面构造器Page()` 并且至少要传入一个**空对象**做为它的参数，否则可能会报错，如下图所示：

![](./images/img-19.jpg)

Page 函数的配置项及其含义：

| 选项 | 含义                                       | 说明                      |
| ---- | ------------------------------------------ | ------------------------- |
| data | `.wxml` 中的动态数据都来自`Page`中的`data` | 类似 vue 组件的 data 函数 |

在了解了上述的知识后，我们看看相关的代码实现一下：

```javascript
// pages/index/index.js
Page({
  data: {
    msg: '大家好，这是我开发的第一个小程序！'
  }
})
```

上述代码中为 `pages/index/index.wxml` 初始了一个数据 `msg`，那如何才能将它渲染到页面当中呢？非常简单通过插值（ 即{{}} ）可以将 `msg` 渲染到指定的页面位置：

```xml
<!-- pages/index/index.wxml -->
<!-- 上一小节页面导航和轮播图代码省略了... -->
<!-- 添加的新代码 -->
<view>{{msg}}</view>
```

保存代码后就可以在页面中看到 "大家好，这是我开发的第一个小程序！" 这段文字了。 

大家自行尝试一下数据据型如果是 数组或对象时如何渲染到页面当中？例如：

```javascript
// pages/index/index.js
Page({
  data: {
    msg: '大家好，这是我开发的第一个小程序！',
    // 初始对象类型的数据
    user: {
      name: '小明',
      age: 18
    }
  }
})
```

揭晓答案：其实也非常简单跟 vue 的语法一样，直接通过 “.” 语法就可以了。

这时告诉大家一个“小秘密”，我们不需要在 wxml 导入 .js 文件，只要保证 .js 文件名称与页面的文件名称保持一致就可以了（是不是在哪里听到过类似的情况）。

在对 data 的知识有了一个了解之后，如何定义方法来充当事件的回调函数，在开始之前介绍一下如何添加事件监听及对初始数据进行修改：

1. 事件监听

小程序中绑定事件的语法为 bind事件名="事件回调" 和 bind:事件名="事件回调" 两种形式，小程序中大部分事件类型与网页中一致，有个特殊的事件类型需要指出，小程序中没有 `click` 事件类型，取而代之的是 `tap` 事件。

名称以 `bind` 开头的事件不阻止冒泡，名称以 `catch` 开头的事件冒泡是阻止的。如 `bind:Tap` 和 `catch:Tab`。

```xml
<!-- page/index/index.wxml -->
<!-- 省略前面几小节的代码 -->
<button bind:tap="sayHi">点击一下</button>
```

上述代码中的 button 也是小程序中内置组件，通过 bind:tap="sayHi" 添加点击事件的监听，sayHi 是一个方法会在点击按钮时被调用，那这个方法我们定义了吗？

在Vue 中是通过 methods 选项来定义方法，然而在小程序的页面中直接定义一个方法就可以了，这一点和 Vue 不一样大家一定要注意，来看具体的用法：

```javascript
// pages/index/index.js
Page({
  data: {
    msg: '大家好，这是我开发的第一个小程序！'
  },
  sayHi() {
    console.log('按钮被点击了...')
  }
})
```

当事件触发时，处理函数会响应，传入 `event` 对象，通过 `event` 对象可以获取事件触发时候的一些信息，这里需要注意的是target和currentTarget的区别，currentTarget为当前事件所绑定的组件，而target则是触发该事件的源头组件

绑定事件后，处理函数不能传入参数，只能通过`data-**="参数"`的方式传递，使用事件对象中 `dataset` 获取数据

```javascript

<view id="tapTest" data-hi="WeChat" bind:tap="tapName"> 点击我 </view>

Page({
  tapName: function(event) {
    console.log(event)
  }
})
```

以上就是小程序中的事件处理方法了，你学会了吗？



2. 更新数据

小程序是由`数据驱动`的开发框架，据我们的经验可以知道 data 中的数据应该是可以根据逻辑的需要进行修改的，那我们就来学习一下小程序中如何修改这些数据吧，假如用户在点击的时候我们将 msg 这个数据修改为 "Hello everybody，this is my first miniprogram!"，如何实现呢？

```javascript
// pages/index/index.js
Page({
  data: {
    msg: '大家好，这是我开发的第一个小程序！'
  },
  
  sayHi() {
    console.log('按钮被点击了...')
    // 错误的写法！
    // this.msg = 'Hello everybody，this is my first miniprogram!'
    
    // 正确的写法
    this.setData({
      msg: 'Hello everybody，this is my first miniprogram!'
    })
  }
})
```

这里要敲黑板了，注意小程序中修改数据不是直接进行赋值，而是通过调用 `this.setData()` 方法来实现的。this.setData 这个方法也是小程序中内置提供的。

好了基础知识铺垫完了，接下来我们就可以实现购物车计数器的功能了：

1. 简单布局一下页面，用到两个按钮组件和一个输入框组件
2. 监听按钮的点击事件，然后对数值进行加1或减1操作
3. 将按钮修改后的结果显示在输入框组件中

```javascript
Page({
  data: {
    msg: '大家好，这是我开发的第一个小程序！',
    // 初始值为 1
    num: 1
  },
  sayHi() {
    // 省略...
  },
  // 购物车数量加1
  increment() {
    if(this.data.number <= 1) return;
    this.setData({
      num: this.data.num + 1
    })
  },

  // 购物车数量减1
  decrement() {
    num: this.data.num - 1
  }
})
```

```xml
<!-- pages/index/index.wxml -->
<!-- 上一小节页面导航和轮播图代码省略了... -->
<button type="primary" bind:tap="increment">-</button>
<input value="{{num}}" />
<button type="primary" bind:tap="decrement">+</button>
```

上述代码中补充的知识，大家一定要注意：

- 为组件的属性绑定数据时也必须使用 {{}} ，这一点与 vue 是不同的
- 读取 data 中的数据通过 this.data.xxx 这一点与 vue 也是不相同的
- 修改data数据必须使用 this.setState({})
- 页面自定义方法没有methods:{}

#### 2.8 小程序配置

前面我们简单介绍了一下 `.json` 类型的文件是用来对小程序进行配置的，如窗口的颜色、标题、自定义组件、底部tab栏等都是通过配置文件来实现的。配置文件又分为全局配置 app.json 和页面里的配置，我们先来看全局的配置：

首先要知道配置文件最外层是一个对象，我们再来看一些常见的配置：

| 配置项        | 类型     | 是否必须 | 说明                           |
| ------------- | -------- | -------- | ------------------------------ |
| pages         | string[] | 是       | 页面路径列表，第一个就是(首页) |
| window        | object   | 否       | 全局的默认窗口表现             |
| tabBar        | object   | 否       | 底部 `tab` 栏的表现            |
| entryPagePath | string   | 否       | 小程序默认启动首页             |

1. pages 的值是一个数组，在这个数组中将所有页面的路径写在这里，小程序中新增/减少页面，都需要对 `pages` 数组进行修改，**否则页面无法被访问到**，默认数组的第一个单元为小程序的启动首页。

```json
{
  "pages": [
    "pages/index/index", //不需要写文件后缀,框架会自动寻找并整合
    "pages/logs/logs"
  ]
}
```

下面我们**新建一个页面**来测试 pages 配置项的使用：

![](./images/img-20.jpg)



在任意文件夹上右键，然后在弹出的菜单中选择【新建Page】，然后输入页面名称（如：demo）然后敲回车，此时便会创建出4个文件来，分别为 demo.wxml、demo.js、demo.wxss、demo.json，这 4 个文件正好是一个完整页面的构成，**不仅如此配置文件 app.json 当中也自动的将这个新建的页面路径**。

![](./images/img-21.jpg)

那 pages 的作用到底是什么呢？如果没有在 pages 中添加这个页面又会出现什么结果呢？下面我们来通过链接跳转的方式来给大家演示一下效果：

| 组件名    | 作用     | 与 htm对比              |
| --------- | -------- | ----------------------- |
| navigator | 地址跳转 | 相当于 html 中的 a 标签 |

在`pages/index/index`页面中添加一个链接并跳转到刚刚创建的 demo 页面

```xml
<!-- pages/index/index.wxml -->
<!-- 省略前几小节代码 -->
<!-- 相对路径 -->
<navigator url="./demo">跳转到 demo 页面</navigator>
<!-- 绝对路径 -->
<navigator url="/pages/index/demo">跳转到 demo 页面</navigator>
```

上述两种情况都可以正常的跳转到 demo 页面，但是如果将 app.json 中的 demo 页面路径删除后，则不能成功跳转了（点击跳转链接后没有任何反应），所以我们必须要把页面的路径填写到 pages 的配置项中。

2. window 的值是一个对象，通过它可以全局配置小程序的状态栏、导航条、标题、窗口背景色。

| 属性                                                         | 类型       | 默认值  | 说明                                     |
| ------------------------------------------------------------ | ---------- | ------- | ---------------------------------------- |
| navigationBarTitleText                                       | string     | 空白    | 导航栏标题文字内容                       |
| navigationBarTextStyle                                       | string     | black   | 导航栏标题颜色，仅支持 `black` / `white` |
| navigationBarBackgroundColor                                 | 16进制颜色 | #00000  | 导航栏背景颜色，如 `#000000`             |
| navigationStyle                                              | string     | default | 导航栏样式，仅支持 `default` / `custom`  |
| enablePullDownRefresh                                        | boolean    | false   | 是否开启全局的下拉刷新                   |
| ... 还有[更多](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html#window) |            |         |                                          |

```json
{
  "pages": [
    "pages/index/index",
    "pages/logs/logs",
    "pages/demo/demo"
  ],
  "window": {
    "navigationBarTitleText": "小程序示例",
    "navigationBarTextStyle": "white",
    "navigationBarBackgroundColor": "#f5a11c",
    "enablePullDownRefresh": true
  }
}
```

3. tabBar 定义小程序 tab 栏的表现，如下图即所谓的 tab 栏：

 ![](./images/img-23.png)



定义tab 的内容有些多，大家参照着上图和下面的表格来对小程序的 tab 栏进行配置：

| 属性            | 类型       | 默认值 | 是否必须 | 说明                                                       |
| --------------- | ---------- | ------ | -------- | ---------------------------------------------------------- |
| list            | array      | 无     | 是       | tab 的列表，详见 `list` 属性说明，最少 2 个、最多 5 个 tab |
| color           | 16进制颜色 | 无     | 否       | tab 上的文字默认颜色，仅支持十六进制颜色                   |
| selectedColor   | 16进制颜色 | 无     | 否       | tab 上的文字选中时的颜色，仅支持十六进制颜色               |
| backgroundColor | 16进制颜色 | 无     | 否       | tab 的背景色，仅只持16进制颜色                             |
| borderStyle     | string     | black  | 否       | tabbar 上边框的颜色， 仅支持 `black` / `white`             |
| position        | string     | bottom | 否       | tabBar 的位置，仅支持 `bottom` / `top`                     |

上述配置中 `list` 具体又包含以下内容：

| 属性             | 类型   | 默认值 | 是否必须 | 说明                                                         |
| ---------------- | ------ | ------ | -------- | ------------------------------------------------------------ |
| pagePath         | string |        | 是       | 页面路径，必须在 pages 中先定义                              |
| text             | string |        | 是       | tab 上按钮文字                                               |
| iconPath         | string |        | 否       | 图片路径，icon 大小限制为 40kb，建议尺寸为 81px * 81px，不支持网络图片，当 `position` 为 `top` 时，不显示 icon |
| selectedIconPath | string |        | 否       | 选中时的图片路径，icon 大小限制为 40kb，建议尺寸为 81px * 81px，不支持网络图片，当 `position` 为 `top` 时，不显示 icon |

以上的配置不用刻意的去背，根据需要随时查询就可以，以下为示例代码：

```json
{
  "pages": [
    "pages/index/index",
    "pages/logs/logs",
    "pages/demo/demo"
  ],
  "window": {
    "navigationBarTitleText": "小程序示例",
    "navigationBarTextStyle": "white",
    "navigationBarBackgroundColor": "#f5a11c",
    "enablePullDownRefresh": true
  },
  "tabBar": {
    "color": "#d78b09",
    "selectedColor": "#fff",
    "backgroundColor": "#feca49",
    "borderStyle": "white",
    "list": [{
      "pagePath": "pages/index/index",
      "text": "首页",
      "iconPath": "static/tabbar/home-default.png",
      "selectedIconPath": "static/tabbar/home-active.png"
    },
    {
      "pagePath": "pages/logs/logs",
      "text": "日志",
      "iconPath": "static/tabbar/ticket-default.png",
      "selectedIconPath": "static/tabbar/ticket-active.png"
    }]
  }
}
```

注意点：tabBar中国list第一项必须是pages的第一项

演练：自已添加一个新的 tab

以上是常用的全局配置项，还有更多[全局配置](https://developers.weixin.qq.com/miniprogram/dev/reference/configuration/app.html)的选项，后续学习当中会根据需要进行讲解。

那接下来咱们再来学习一下**页面配置**，顾名思义页面配置只针对某个页面生效，如 index.json 是针对 index 页面生效，demo.json 是针对页面 demo 生效，页面的部分配置可以覆盖全局 app.json 中的配置，常见的配置如下表：

| 属性                         | 类型       | 默认值  | 是否必须 | 说明                                     |
| ---------------------------- | ---------- | ------- | -------- | ---------------------------------------- |
| navigationBarTitleText       | string     | 空白    | 否       | 导航栏标题文字内容                       |
| navigationBarTextStyle       | string     | black   | 否       | 导航栏标题颜色，仅支持 `black` / `white` |
| navigationBarBackgroundColor | 16进制颜色 | #00000  | 否       | 导航栏背景颜色，如 `#000000`             |
| navigationStyle              | string     | default | 否       | 导航栏样式，仅支持 `default` / `custom`  |
| enablePullDownRefresh        | boolean    | false   | 否       | 是否开启全局的下拉刷新                   |

有没有发现上表中的配置内容其实是全局配置中 window 部分的内容，写在 app.json 中的属于全局配置对所有的页面都生效，而写在页面中的只对当前页面生效，并且会覆盖全局的同名的配置，下面代码是 demo 页面即 demo.json 中的配置：

```json
{
  navigationBarBackgroundColor: '#ff0',
  enablePullDownRefresh: false
}
```

到此我们就对小程序有了大致的了解了。

### 3. 小程序调试

任何程序开发都离不开调试，小程序开发者工具自带了调试工具，下面我们就来学习小程序开发者工具的调试功能。

#### 3.1 调试器

![image-20220705220843204](images/image-20220705220843204.png)

上图中的 【Wxml】 是用来显示小程序页面的结构和样式，【Console】 控制台，【Network】 查看网络请求，【AppData】 查看组件本地数据，【终端】创建命令行窗口等。

#### 3.2 预览和真机调试

在大部情况下我们编写的代码会在开发者工具的模拟器中查看到效果，不仅如此开发者工具还允许我们在真机中进行预览或调试，实现这个功能非常简单，如下图所示：

![image-20220706095434500](images/image-20220706095434500.png)

如上图所示点击预览或者真机调试等待片刻会出现一个二维码，**此时只有管理员或指定的开发成员才可以扫码查看**，如果点击的是真机调试时还会自动打开一个调试面板对真机上的小程序进行调试（详细见课堂演示）。

这里有个问题，指定的开发成员是什么意思呢？

开发成员就是一个团队共同开发同一个小程序的情形，在小程序管理后台可以添加开发成员，添加了开发成员后大家就可以使用同一个 AppID 开发同一个小程序了，我们还学习一下如何添加开发成员，[登录小程序管理后台](https://mp.weixin.qq.com/)，找到【成员管理】，如下图：

![image-20220705223828776](images/image-20220705223828776.png)

以上图中的步骤根据引导通过【微信号】添加成员即可，大家可以互想添加成员测试一下该功能的应用。

#### 3.3 编译模式

编译模式是允许开发者为某个页面指定编译模式来进行调试，当前我们先有个简单的了解，使用的步骤如下：

![image-20220705221629336](images/image-20220705221629336.png)

![image-20220705221845232](images/image-20220705221845232.png)

这个功能我们暂时还用不到，大家先有个了解即可。

#### 3.4 刷新和热重载

早期小程序开发者工具是没有刷新的功能，只有编译功能，即每次修改代码后都会将页面重新编译，这种情况下开发效率比较低，现在的小程序开发工具中支持了刷新和热重载的功能。

![image-20220705222105501](images/image-20220705222105501.png)

### 4. 协同工作

多数情况下，一个团队多人同时参与同一个小程序项目，每个角色所承担的工作或者权限不一样，中大公司的分工更为仔细。

#### 4.1 人员组织结构和权限分配

为了更形象的表达团队不同角色的关系以及权限的管理，我们通过虚拟一个项目成员组织结构来描述日常如何协同合作完成一个小程序的发布

![image-20220711095439230](images/image-20220711095439230.png)

#### 4.2 提需求到发布小程序的流程

项目管理成员负责统筹整个项目的进展和风险、把控小程序对外发布的节奏，产品组提出需求，设计组与产品讨论并对需求进行抽象，设计出可视化流程与图形，输出设计方案。开发组依据设计方案，进行程序代码的编写，代码编写完成后，产品组与设计组体验小程序的整体流程，测试组编写测试用例并对小程序进行各种边界测试。

![image-20220711095814298](images/image-20220711095814298.png)

### 5. 小程序发布

 小程序开发完毕后，最后一个环节就是将小程序发布到微信小程序的应用商店中。

#### 5.1 小程序版本

| **权限**   | **说明**                                                     |
| :--------- | :----------------------------------------------------------- |
| 开发版本   | 使用开发者工具，可将代码上传到开发版本中。 开发版本只保留每人最新的一份上传的代码。点击提交审核，可将代码提交审核。开发版本可删除，不影响线上版本和审核中版本的代码。 |
| 体验版本   | 可以选择某个开发版本作为体验版，并且选取一份体验版。         |
| 审核中版本 | 只能有一份代码处于审核中。有审核结果后可以发布到线上，也可直接重新提交审核，覆盖原审核版本。 |
| 线上版本   | 线上所有用户使用的代码版本，该版本代码在新版本代码发布后被覆盖更新。 |

#### 5.2 小程序上传

小程序开发并调试完毕后直接点击【上传】按钮，填写版本信息后小程序会被上传到微信的服务器当中，如下图所示：

![image-20220705222146150](images/image-20220705222146150.png)

在上传小程序代码时有一点大家需要注意，微信官方要求小程序的体积不能超过2M，超过2M时上传不会成功，要解决这个问题可以采用分包的功能，这个功能我们在后面再学习。

一般情况小程序的纯代码的体积不会超过2M，之所以超出多数是由图片导致的，一般的解决方法是将图片放到服务器上而不是在小程序本地。



#### 5.3 体验版

上一步骤只是将代码上传到了小程序的官方服务器上，用户还是无法通过小程序商品搜索找到的，需要正式发布前一般还需要进一步对小程序的各项功能进行全方面的测试，即提交【体验版本】，体验版本只能部分用户访问小程序（一般是客户或内部的产品、测试从员），提交体验版本的步骤如下图：

![image-20220705222924256](images/image-20220705222924256.png)

体验成员（客户或内部产品、测试）需要在后台添加，如下图所示：

仍然是通过【微信号】添加体验成员，大家互相添加一下。

![image-20220705223124975](images/image-20220705223124975.png)

#### 5.4 提交审核

小程序全面测试完毕后还需要提交给小程序官方审核，主要是看小程序[有无违规的内容](https://developers.weixin.qq.com/community/develop/doc/000c266f094ab00976ad5c0d251809)。

![image-20220706095952263](images/image-20220706095952263.png)

#### 5.5 发布

审核通过后就可发布小程序了，发布成功后所有用户都可以在小程序应用商品中找到我们开发的小程序了。



### 6. 作业

课堂布置



